# 04. 不変条件（Validate）で「正しさ」を体感する

学習中に一番つらいのは「たぶん合ってる…」のまま進むことです。
このリポジトリでは、Bツリーの構造が壊れていないかを `Validate()` で検査できます。

## Validate が見ているもの（要約）

- **キー配列が厳密昇順**（重複・逆転がない）
- **キー数の範囲**（root以外は \(t-1..2t-1\)）
- **子の数**（内部ノードは `len(children)==len(keys)+1`、葉は `children==0`）
- **部分木レンジ**（親のキーで子の値域が正しく区切られている）
- **葉の深さ**（すべて同じ深さ）

実装: `node.validateRec`

## どう使う？

CLI で `-validate` を付けると、各操作後に検証できます。

```bash
go run ./cmd/btree-demo -t 2 -ops "ins 1,ins 2,ins 3,del 2,del 1" -print -validate
```

## よくある壊れ方（学習者あるある）

- **split で中央値を上げ忘れる / ずらし忘れる**
- **merge で親のキー削除と子削除の順序を間違える**
- **borrow で子ポインタの移動を忘れる（内部ノード時）**
- **削除で「マージ後にどの子へ降りるか」の index がズレる**

この実装では、まさに上の「indexズレ」みたいなバグを早期発見するために `Validate()` を強めにしています。

